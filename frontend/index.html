<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link rel="stylesheet" href="./CSS/bootstrap.css" />
    <script src="./jquery.js"></script>
    <script>
      //uplpoad file
      $(document).on("submit", "#first_form", function (e) {
        e.preventDefault();
        var formData = new FormData(this);
        $.ajax({
          headers: {
            "Access-Control-Allow-Origin":
              "https://" + window.location.hostname + ":8005",
          },
          method: "POST",
          url: "https://" + window.location.hostname + ":8080/upload-dicom", // backend url
          data: formData,
          cache: false,
          contentType: false,
          processData: false,
          xhrFields: { withCredentials: true },
          beforeSend: function () {
            $('button[id="btnsubmit"]').attr("disabled", "disabled");
          },
          success: function (data) {
            $('button[id="btnsubmit"]').removeAttr("disabled");
            $("#uploadDICOMzip").css("display", "none");
            $("#sendreporttodr").css("display", "flex");
          },
        });
      });

      //download report
      function download() {
        axios({
          url: "localhost:5000/download", // backend url
          method: "GET",
          responseType: "blob",
          withCredentials: false,
        }).then((response) => {
          console.log(response);
          const url = window.URL.createObjectURL(new Blob([response.data]));
          const link = document.createElement("a");
          link.href = url;
          link.setAttribute("download", "report.zip");
          document.body.appendChild(link);
          link.click();
          document.body.removeChild(link);
        });
      }

      //send to DR
      $.ajax({
        type: "POST",
        url: "127.0.0.1:5000/sendTelegram/+989393118594", // backend url
        data: $("select#DRsname").serialize(),
      }).done(function (data) {
        console.log("salam");
      });
    </script>
  </head>
  <body class="bg-light">
    <header class="navbar bg-dark align-items-center">
      <div class="container-fluid">
        <p class="bg-dark text-white text-center p-3">
          liver truma detection system
        </p>
      </div>
    </header>
    <section
      class="d-flex flex-row mx-auto my-5 container bg-dark p-4 justify-content-evenly rounded-2"
    >
      <section
        class="d-flex flex-column mx-3 col-5 container p-2 bg-black rounded-2"
      >
        <img
          src="./imgs/3641634.jpg"
          alt="doctors"
          style="height: 30rem; width: 30rem"
        />
      </section>
      <form id="first_form" enctype="multipart/form-data">
        <section
          class="d-flex flex-column mx-2 bg-black container px-2 rounded-2"
          id="uploadDICOMzip"
        >
          <div class="col-5 mx-2 pt-3">
            <div class="my-3 rounded">
              <input
                class="form-control"
                type="file"
                name="dicomzip"
                id="uploadFile"
                method="post"
                action=""
                multiple
              />
            </div>
            <input
              type="submit"
              value="Upload Now"
              name="submit"
              id="btnsubmit"
              class="btn btn-outline-success p-2"
            />
          </div>
        </section>
      </form>
      <section
        class="d-flex flex-column mx-2 bg-black container px-5 pt-3 rounded-2"
        id="sendreporttodr"
      >
        <p class="text-white">send report to doctor</p>
        <select
          class="form-select w-50 p-2"
          aria-label="select DR name"
          id="DRsname"
        >
          <option selected>defult</option>
          <option value="1">One</option>
          <option value="2">Two</option>
          <option value="3">Three</option>
        </select>
        <hr />
        <input
          type="submit"
          value="send"
          name="submit"
          id="btnsend"
          class="btn btn-outline-success ps-2"
          style="width: fit-content"
        />
        <hr />
        <hr />
        <p class="text-white">download report here</p>
        <a
          onclick="window.open('https://' + window.location.hostname + ':8080/download-report', '_blank');"
          target="_blank"
          class="btn btn-outline-info p-2"
          style="width: fit-content"
          >download
        </a>
      </section>
    </section>
    <footer></footer>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.2/dist/umd/popper.min.js"
      integrity="sha384-7+zCNj/IqJ95wo16oMtfsKbZ9ccEh31eOz1HGyDuCQ6wgnyJNSYdrPa03rtR1zdB"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js"
      integrity="sha384-QJHtvGhmr9XOIpI6YVutG+2QOK9T+ZnN4kzFN1RtK3zEFEIsxhlmWl5/YESvpZ13"
      crossorigin="anonymous"
    ></script>
  </body>
</html>
